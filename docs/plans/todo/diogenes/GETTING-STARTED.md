[["GETTING STARTED", "": "Remove Unreliable Senses and Fix JSON Output", "This guide helps you start working on the diogenes parser improvements.", "Prerequisites", "===========\n", "1. Make sure devenv is available and working:", "   devenv shell langnet-cli -- python --version", "\n2. Run existing tests to ensure baseline:", "   devenv shell langnet-cli -- just test", "\n3. Create a new branch for your work:", "   git checkout -b fix/diogenes-senses-and-json", "Quick Start Guide", "================", "\nStep 1: Verify the Issue", "-------------------------", "Run this command to see the current problems:", "\n", "devenv shell langnet-cli -- tool diogenes parse --lang lat --query lupus --output json | jq '.'", "\nYou should see:", "- JSON parse error (control characters)", "- Output contains a 'senses' field with unreliable data", "\nStep 2: Start with Task 1 (Add Sanitization)", "------------------------------------------", "Open src/langnet/diogenes/core.py and find the DiogenesScraper class.", "\nAdd this new method after __init__:", "\n", "def _sanitize_text(self, text: str) -> str:", "    \"", "Remove control characters that break JSON serialization.\"", "\n    control_chars = {\"\\r\": \"", "\\\n\": \"", "\\\t\": \"", "\\v\": \"", "\\f\": \"", "\\x1b": "control_chars.items():\n        text = text.replace(char, replacement)\n    return text\n```\n\nThen find the parse_word() method (around line 541) and change:", "\n", "documents = response.text.split(\"<hr />\": "cleaned_response = self._sanitize_text(response.text)\ndocuments = cleaned_response.split(\"<hr />": "Step 3: Test the Fix", "-----------------", "Run:", "\n", "devenv shell langnet-cli -- tool diogenes parse --lang lat --query lupus --output json | jq '.'", "\nYou should now see valid JSON output (no parse error).", "\nStep 4: Continue with Remaining Tasks", "-------------------------------------", "Refer to the full plan at:", "docs/plans/todo/diogenes/REMOVE_UNRELIABLE_SENSES.md", "\nTasks in order:", "2. Remove senses field from DiogenesDefinitionBlock dataclass", "3. Remove helper methods (_collect_senses, _deduplicate_senses, etc.)", "4. Remove senses collection from _process_block() method", "5. Update tests", "6. Manual testing", "7. Lint and type check", "Useful Commands", "===============", "\n# Run all tests\njust test\n\n# Run specific diogenes tests\nnose2 -s tests --config tests/nose2.cfg test_diogenes_scraper\n\n# Check for senses field usage\ngrep -rn \"senses", "src/langnet/diogenes/core.py\n\n# Check for helper method usage\ngrep -rn \"_collect_senses\|_deduplicate_senses\" src/langnet/\n\n# Lint code\njust ruff-check\njust ruff-format\n\n# Type check\njust typecheck\n\n# Test CLI output\ndevenv shell langnet-cli -- tool diogenes parse --lang lat --query lupus --output json | jq '.'\n\n# Test multiple words\nfor word in lupus puer bellum amo tempus; do\n    devenv shell langnet-cli -- tool diogenes parse --lang lat --query $word --output json | jq '.' > /dev/null\ndone\n\n# Test Greek word\ndevenv shell langnet-cli -- tool diogenes parse --lang grc --query logos --output json | jq '.'", "Checklist When Done", "===================", "\n- [ ] JSON output parses with jq", "- [ ] JSON output parses with Python's json.loads()", "- [ ] No 'senses' field in any output", "- [ ] entryid hierarchy is preserved", "- [ ] All tests pass (just test)", "- [ ] No linting errors (just ruff-check)", "- [ ] No type checking errors (just typecheck)", "Troubleshooting", "===============", "\nProblem: Tests fail after removing senses field\nSolution: Delete test_lupus_has_known_sense test in tests/test_diogenes_scraper.py\n\nProblem: grep shows senses field still exists\nSolution: Check for all DiogenesDefinitionBlock() constructions and remove senses= parameter\n\nProblem: JSON still has control characters\nSolution: Verify parse_word() is calling _sanitize_text() on response.text\n\nProblem: Tests fail with import errors\nSolution: Make sure you're in the devenv shell: devenv shell langnet-cli -- <command>", "Getting Help", "============", "\nRefer to the full plan for details:", "docs/plans/todo/diogenes/REMOVE_UNRELIABLE_SENSES.md", "\nEstimated time: 3 hours", ""]]